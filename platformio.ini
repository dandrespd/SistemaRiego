; PlatformIO Project Configuration File
; Base environment for shared configurations
[env:base]
platform = native
; Common libraries for all environments
lib_deps = 
    bblanchon/ArduinoJson@^6.21.4
    platformio/unity@^4.3.2

[platformio]
src_dir = src

; USB Flashing Environment
[env:esp32doit-usb]
extends = env:esp32dev
upload_protocol = esptool
upload_speed = 115200
upload_flags = --flash_mode qio
upload_port = /dev/ttyUSB0
monitor_port = /dev/ttyUSB0

; ESP32 Development Environment
[env:esp32dev]
extends = env:base
platform = espressif32
board = esp32dev
framework = arduino

; Configuración de puertos (Linux)
upload_port = /dev/ttyUSB0
monitor_port = /dev/ttyUSB0
monitor_speed = 115200

platform_packages = 
    framework-arduinoespressif32 @ https://github.com/espressif/arduino-esp32.git#2.0.14
check_tool = cppcheck
check_flags = 
    cppcheck: --enable=warning,style --inline-suppr
    clangtidy: --checks=*

; Agregar dependencias específicas para ESP32
lib_deps = 
    ${env.lib_deps}
    caligari/Ds1302@^1.1.0
    esphome/ESPAsyncWebServer-esphome@^3.2.2
    esphome/AsyncTCP-esphome@^2.0.1

; Native Test Environment
[env:native]
platform = native
board = esp32doit-devkit-v1
framework = arduino
monitor_speed = 115200
lib_deps = 
    bblanchon/ArduinoJson@^6.21.4
    platformio/unity@^4.3.2
    caligari/Ds1302@^1.1.0
    esphome/ESPAsyncWebServer-esphome@^3.2.2
    esphome/AsyncTCP-esphome@^2.0.1

; Filesystem configuration
board_build.filesystem = littlefs
board_build.partitions = custom_partitions.csv

; Unified include configuration
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM
    -DARDUINOJSON_USE_LONG_LONG=1
    -I${PROJECT_DIR}/src
    -I${PROJECT_DIR}/lib
    -I${PROJECT_DIR}/include
    -I${PROJECT_DIR}/.pio/libdeps/esp32dev

lib_ldf_mode = deep+
platform_packages = 
    framework-arduinoespressif32 @ https://github.com/espressif/arduino-esp32.git#2.0.14
    toolchain-xtensa-esp32 @ 8.4.0+2021r2-patch5

; OTA Configuration
upload_protocol = espota
upload_port = riego-inteligente.local
upload_flags =
    --auth=riego2025secure
    --port=3232
    --flash_mode qio  # Required for most ESP32 boards

; ========================
; Ejecutar verificaciones:
; pio check --environment esp32dev
; ========================

; OTA Environment
[env:esp32dev-ota]
extends = env:esp32dev
upload_protocol = espota
upload_flags = --flash_mode qio
