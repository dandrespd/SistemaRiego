; PlatformIO Project Configuration File
[platformio]
src_dir = firmware/src

; ESP32 Development Environment
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
check_tool = cppcheck
check_flags = 
    cppcheck: --enable=warning,style --inline-suppr
    clangtidy: --checks=*

; Native Test Environment
[env:native]
platform = native
board = esp32doit-devkit-v1
framework = arduino
monitor_speed = 115200
lib_deps = 
    platformio/unity@^4.3.2
    caligari/Ds1302@^1.1.0
    esphome/ESPAsyncWebServer-esphome@^3.2.2
    esphome/AsyncTCP-esphome@^2.0.1
    bblanchon/ArduinoJson@^6.21.4
    ESPmDNS@^2.0.0

; Filesystem configuration
board_build.filesystem = littlefs  # Better alternative to SPIFFS
board_build.partitions = min_spiffs.csv  # Optimized for web files

; Compilation flags
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM
    -DARDUINOJSON_USE_LONG_LONG=1
    -I${PROJECT_DIR}/firmware
    -I${PROJECT_DIR}/firmware/include
    -I${PROJECT_DIR}/firmware/src

; OTA Configuration
upload_protocol = espota
upload_port = riego-inteligente.local
upload_flags =
    --auth=riego2025secure
    --port=3232
    --flash_mode qio  # Required for most ESP32 boards

; ========================
; Ejecutar verificaciones:
; pio check --environment esp32dev
; ========================

; USB Flashing Environment
[env:esp32doit-usb]
extends = env:esp32dev
upload_protocol = esptool
upload_speed = 115200
upload_flags = --flash_mode qio

; OTA Environment
[env:esp32dev-ota]
extends = env:esp32dev
upload_protocol = espota
upload_flags = --flash_mode qio
